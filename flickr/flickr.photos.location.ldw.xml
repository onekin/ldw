<table  xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
    <meta>
        <sampleQuery>use "store://33Bggiu3ToFSw4UgYBJAIo" as flickr; select * from flickr where location='donostia' and api_key='2a97cfbd41563a5c6a5dbb9853fcb7d2' | flickr.lifting('http://rdf.onekin.org/flickr/location/donostia') </sampleQuery>
        <sampleQuery>env "store://daTl8yRJHWSUpGaFMbyzQk"; select * from flickr where location='donostia' | flickr.lifting('http://rdf.onekin.org/flickr/location/donostia')</sampleQuery>
        <author>Christian Heilmann (author of the original ODT)</author>
        <author>Iker Azpeitia (author of this ODT++)</author>
        <documentationURL>http://www.wait-till-i.com/2009/11/01/getting-a-list-of-flickr-photos-by-location-andor-search-term-with-a-yql-open-table</documentationURL>
        <description>Searches Flickr by location and returns an HTML list that can be immediately used in a mashup.</description>
        <sampleQuery>URIPattern: flickr.photos.location.ldw/{location}</sampleQuery>
	<sampleQuery>URIexample: flickr.photos.location.ldw/donostia</sampleQuery>
    </meta>
    <bindings>
        <select itemPath="results.photo" produces="XML">
            <inputs>
                <key id="location" type="xs:string" paramType="variable" required="true"/>
                <key id="amount" type="xs:integer" paramType="variable" required="false" default="25"/>
                <key id="api_key" type="xs:string" paramType="variable" required="true" private="true"/>           
            </inputs>
            <execute><![CDATA[ 
        var query = 'select farm,id,secret,owner.realname,server,title,'+
                    'urls.url.content from flickr.photos.info where api_key="'+ api_key +
                    '" and photo_id in (select id from flickr.photos.search('+
                     amount + ') where api_key="' + api_key +
          			'" and woe_id in (select woeid from geo.places where text="' + 
                    location+'"))';
        var x = y.query(query);
      	response.object = x.results;]]>
      		</execute>
        </select>
        
        <function name="lifting">
<inputs>
<pipe id="oneLocationXML" paramType="variable" />
<key id="URI" paramType="variable" required="true"/>
</inputs>
<execute> <![CDATA[
var oneLocationJSON= y.xmlToJson(oneLocationXML);
var oneLocationJSONLD={'@context':{rdfs:'http://www.w3.org/2000/01/rdf-schema#',
foaf: 'http://xmlns.com/foaf/0.1/', geo: 'http://www.w3.org/2003/01/geo/wgs84_pos#'}};
oneLocationJSONLD['@id']= URI;
oneLocationJSONLD['@type']='geo:SpatialThing';
oneLocationJSONLD['foaf:depiction']='http://rdf.onekin.org/flickrphoto/'+oneLocationJSON.photo.id;
response.object = oneLocationJSONLD;]]>
</execute>
</function>
        
    </bindings>
</table>
