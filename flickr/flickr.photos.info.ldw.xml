<?xml version="1.0" encoding="UTF-8"?>      <table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">    <meta>        <author>Iker Azpeitia</author>        <description>A LD wrapper to retrieve a Flickr photo's information.</description>        <!--lowering-->        <sampleQuery> URIPattern: http://rdf.onekin.org/flickr.photos.info.ldw/resource/{id}</sampleQuery>		<sampleQuery> URIExample: http://rdf.onekin.org/flickr.photos.info.ldw3/resource/8142637344</sampleQuery>		<sampleQuery> URIExample: http://rdf.onekin.org/flickr.photos.info.ldw3/resource/25720894320</sampleQuery>	</meta>    <bindings>        <select itemPath="results.*" produces="XML">            <inputs>		<key id="id" type="xs:string" paramType="variable" required="true"/>		<key id="api_key" type="xs:string" paramType="variable" required="true" default="2c894ba749b4137b6f7ab127c86890ec"/>             </inputs>             <execute>                <![CDATA[ var loweringselect = "env 'store://datatables.org/alltableswithkeys'; select * from flickr.photos.info where photo_id=@id and api_key=@api_key"; var loweringparams ={}; loweringparams ['id']= id; loweringparams ['api_key']= api_key; var loweringquery = y.query (loweringselect,loweringparams); response.object =  loweringquery.results; ]]>            </execute>      </select> <function name="lifting">  <inputs>     <pipe id="oneXML" paramType="variable"/>     <key id="URI" paramType="variable" required="true"/>  </inputs> <execute><![CDATA[function getValue(dataPath) {	try{return eval(dataPath) || null; }catch(err){return null;}}function getInterlink (urlpattern, value){try{return value? urlpattern.replace(/{.*}/, value) : null;}catch(err){return null;}}function getDepiction (){  var farm =getValue("oneJSON['photo']['farm']");  var server =getValue("oneJSON['photo']['server']");  var id=getValue("oneJSON['photo']['id']");  var secret=getValue("oneJSON['photo']['secret']");  var atid = 'https://c1.staticflickr.com/'+farm+'/'+server+'/'+id+'_'+secret;  var owner = getValue("oneJSON['photo']['owner']['nsid']");  var page = 'http://www.flickr.com/photos/'+owner+'/'+id;  var title=getValue("oneJSON['photo']['title']");  return [{"@type": "http://xmlns.com/foaf/0.1/Image",                 "@id": atid+'_z.jpg',                 "page": page,                 "title": title              }, {"@type": "http://xmlns.com/foaf/0.1/Image",                             "@id": atid+'_m.jpg',                             "page": page,                             "title": title                          }];}function getPlace (){  var locationURI = getInterlink ('http://rdf.onekin.org/geo.places.ldw/place/{text}', toUnderscoreFormat(firstNotNull (locality, locality2)));return locationURI;}function getThumbnailUrl (){  var farm =getValue("oneJSON['photo']['farm']");  var server =getValue("oneJSON['photo']['server']");  var id=getValue("oneJSON['photo']['id']");  var secret=getValue("oneJSON['photo']['secret']");  var atid = 'https://c1.staticflickr.com/'+farm+'/'+server+'/'+id+'_'+secret;  return atid+'_z.jpg';}function firstNotNull(a, b){  if (a) return a;  if (b)  return b;  return null;}function toDurationFormat(str) {  try{    var secs = parseInt(str);    var mins = Math.floor(secs/60);    secs = secs - (mins*60);    return "PT"+mins+"M"+secs+"S";  }catch(err){return "33PT0M00S";}}function toDBPediaFormat(str) {    var arr = str.split(/\s|_/);    for(var i=0,l=arr.length; i<l; i++) {        arr[i] = arr[i].substr(0,1).toUpperCase() + (arr[i].length > 1 ? arr[i].substr(1).toLowerCase() : "");    }    var res = toUnderscoreFormat(str);    return res? 'http://dbpedia.org/resource/' + res: null;}function toUnderscoreFormat(str) {    if (!str) return null;    var arr = str.split(/\s|_/);    for(var i=0,l=arr.length; i<l; i++) {        arr[i] = arr[i].substr(0,1).toUpperCase() + (arr[i].length > 1 ? arr[i].substr(1).toLowerCase() : "");    }    return arr.join("_");}function getEncoded(txt){return txt? txt.replace ('"', "'"): null;}function getLength(obj) {try{return obj? obj.length: 0; }catch(err){return 0;}}try{ var oneJSON= y.xmlToJson(oneXML);	var oneJSONLD={};	oneJSONLD['@id']=URI;	oneJSONLD['@context']= {"dcterms": "http://purl.org/dc/terms/", "schema":"http://schema.org/",    "name": "http://schema.org/name",    "description": "http://schema.org/description",    "thumbnailUrl": "http://schema.org/thumbnail",    "uploadDate": "http://schema.org/uploadDate",    "duration": "http://schema.org/duration",    "contentURL": "http://schema.org/contentURL",    "embedUrl": "http://schema.org/embedUrl",    "interactionCount": "http://schema.org/interactionCount",      "lat": "http://schema.org/latitude",      "long": "http://schema.org/longitude",      "location": "http://schema.org/geo",      "depiction": "http://schema.org/thumbnailUrl"};  oneJSONLD['@type']= (getValue("oneJSON['photo']['media']") == 'video') ? 'VideoObject' : 'ImageObject';  oneJSONLD['name'] = getValue("oneJSON['photo']['title']");  oneJSONLD['description'] = getEncoded(getValue("oneJSON['photo']['description']"));  oneJSONLD['thumbnailUrl'] = getThumbnailUrl ();  oneJSONLD['uploadDate'] = getValue("oneJSON['photo']['dates']['taken']");  oneJSONLD['duration'] = toDurationFormat(getValue("oneJSON['photo']['video']['duration']"));  oneJSONLD['contentUrl'] = getValue("oneJSON['photo']['urls']['url'].content");  oneJSONLD['interactionCount']=getValue("oneJSON['photo']['views']")  oneJSONLD['depiction'] = getDepiction ();  oneJSONLD['dcterms:subject']=[];  oneJSONLD['schema:contentLocation']=[];  var lat= null;  var lon= null;  var locality = null;   for (var LOOP4 = 0; LOOP4 < getLength(getValue("oneJSON['photo']['tags']['tag']")); LOOP4++){  	s = getValue("oneJSON['photo']['tags']['tag'][LOOP4]['raw']");    if (s.indexOf(':')>=0){      if (s.indexOf('geo:city=')==0 || s.indexOf('geo:locality=') ==0){        s= s.substring(s.indexOf("=") + 1);        locality = toUnderscoreFormat(s);      }else if (s.indexOf('geo:lat=')==0){        s= s.substring(s.indexOf("=") + 1);        lat= s;      }else if (s.indexOf('geo:lon=')==0){          s= s.substring(s.indexOf("=") + 1);          lon= s;    }}else{      oneJSONLD['dcterms:subject'].push (toDBPediaFormat(s));    }  }  var oneJSONLD1={};  oneJSONLD1['@type']= 'GeoCoordinates';  oneJSONLD1['lat'] = firstNotNull(getValue("oneJSON['photo']['location']['latitude']"), lat);  oneJSONLD1['long'] = firstNotNull(getValue("oneJSON['photo']['location']['longitude']"), lon);  oneJSONLD['location'] = oneJSONLD1;  var locality2 = firstNotNull(getValue("oneJSON['photo']['location']['locality']['content']"), getValue("oneJSON['photo']['location']['county']['content']"));//  oneJSONLD['schema:locationCreated'] = getInterlink ('http://rdf.onekin.org/geo.places.ldw/place/{text}', toUnderscoreFormat(firstNotNull (locality, locality2)));  oneJSONLD['schema:locationCreated'] = getPlace ();  oneJSONLD['schema:interactionStatistic'] =[];  var oneJSONLD1={};  oneJSONLD1['@type']= 'InteractionCounter';  oneJSONLD1['schema:interactionType']='http://schema.org/WatchAction';  oneJSONLD1['schema:userInteractionCount']=getValue("oneJSON['photo']['views']");  oneJSONLD['schema:interactionStatistic'].push(oneJSONLD1);  var oneJSONLD1={};  oneJSONLD1['@type']= 'InteractionCounter';  oneJSONLD1['schema:interactionType']='http://schema.org/LikeAction';  oneJSONLD1['schema:userInteractionCount']=0;  oneJSONLD['schema:interactionStatistic'].push(oneJSONLD1);  var oneJSONLD1={};  oneJSONLD1['@type']= 'InteractionCounter';  oneJSONLD1['schema:interactionType']='http://schema.org/CommentAction';  oneJSONLD1['schema:interactionCount']=getValue("oneJSON['photo']['comments']");  oneJSONLD['schema:interactionStatistic'].push(oneJSONLD1);    }catch (err){ y.log(err);}    response.object = oneJSONLD;]]>   </execute></function>    </bindings> </table>