<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
    <author>Iker Azpeitia</author>
    <description>Linked Data wrapper for Last.fm Event.getInfo API method. Get the metadata for an event on Last.fm. Includes attendance and lineup information.</description>
    <documentationURL>http://www.datatables.org/lastfm/lastfm.event.getinfo.xml</documentationURL>
    <sampleQuery>URIPattern: lastfm/event/{event}</sampleQuery>
    <sampleQuery>URIexample: lastfm/event/3986264</sampleQuery>
  </meta>
  <bindings>
    <select itemPath="" produces="XML">
      <urls>
        <url>http://ws.audioscrobbler.com/2.0/?method=event.getinfo</url>
      </urls>
      <inputs>
        <key id="event" type="xs:string" paramType="query" required="true" />
        <key id="api_key" type="xs:string" paramType="query" required="true" />
      </inputs>
    </select>
            <function name="lifting">
           <inputs>
               <pipe id="oneEventXML" paramType="variable" />
               <key id="URI" paramType="variable"  required="true"/>
            </inputs>    
          <execute> <![CDATA[ 
var oneEventXML= y.xmlToJson(oneEventXML);
oneEventJSONLD['@context']= {rdfs:'http://www.w3.org/2000/01/rdf-schema#',
  		  dc: 'http://purl.org/dc/elements/1.1/',
  		  mo: 'http://purl.org/ontology/mo/',
  		  event: 'http://purl.org/NET/c4dm/event.owl#'};   
oneEventJSONLD['@id']= URI;
oneEventJSONLD['@type']='mo:Performance';
oneEventJSONLD['dc:date']= oneEventXML.lfm.event.startDate;
oneEventJSONLD['rdfs:label']= oneEventXML.lfm.event.title;
oneEventJSONLD['event:place']= 'http://www.dbpedia.org/resource/'+oneEventXML.lfm.event.venue.location.city;
oneEventJSONLD['mo:performer']=  'http://rdf.onekin.org/musicbrainz/artist/'+oneEventXML.lfm.event.artists.artist; 
//TODO: oneEventJSONLD['unknown:unknown']= oneEventXML.lfm.event.cancelled;
//TODO: oneEventJSONLD['event:place']= 'http://rdf.onekin.org/yelp/location/'+oneEventXML.lfm.event.venue.location.city;
//TODO: oneEventJSONLD['@context']['dbpedia']="unknown";   
response.object = oneEventJSONLD;
;]]>
            </execute>
           </function>
  </bindings>
</table>
