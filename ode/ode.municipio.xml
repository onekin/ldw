<?xml version="1.0" encoding="UTF-8"?>
      <table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
    <meta>
        <author><!-- your name or company name --></author>
        <description><!-- description of the table --></description>
        <documentationURL><!-- url for API documentation --></documentationURL>
        <apiKeyURL><!-- url for getting an API key if needed --></apiKeyURL>
        <!--lowering-->
        <sampleQuery> URIPattern: http://rdf.onekin.org/ode/municipio/{nombre}</sampleQuery>
        <sampleQuery> URIExample: http://rdf.onekin.org/ode/municipio/zarautz</sampleQuery>
    </meta>
    <bindings>
        <select itemPath="results.*" produces="XML">
            <inputs>
		<key id="nombre" type="xs:string" paramType="variable" required="true"/>
             </inputs>
             <execute>
                <![CDATA[
 var q = "use 'store://yyexuUcTZ5KrcW5qrtKQDK' as t; select row from t where url =@url AND separator =@separator AND columnsrow =@columnsrow AND row.Poblacin LIKE @nombre";
 var params ={};
 params ['url']= 'www2.irekia.euskadi.net/open_data/gc_ayuntamientos_datos_completos.csv';
params ['separator']= ';';
params ['columnsrow']= 'true';
params ['nombre']= nombre+'%';
y.log('va');
 var query = y.query (q,params); 
 response.object =  query.results;
 ]]>
            </execute>
      </select>
  <function name="lifting">
	<inputs>
		<pipe id="oneXML" paramType="variable"/>
		<key id="URI" paramType="variable" required="true"/>
	</inputs>
	<execute>
	<![CDATA[
	var oneJSON= y.xmlToJson(oneXML);
	var oneJSONLD={};
	oneJSONLD['@id']=URI;
	oneJSONLD['@context']= {"vcard":"http://www.w3.org/2006/vcard/ns#", "dbpediaont":"http://dbpedia.org/ontology/"};
	oneJSONLD['@type']= 'vcard:Organization';
  oneJSONLD['vcard:fn'] = oneJSON['rows']['row']['Poblacin'];
  oneJSONLD['vcard:additional-name'] = oneJSON['rows']['row']['Entidad'];
  var oneJSONLDaddr={};
  oneJSONLDaddr['@type']= 'vcard:Address';
  oneJSONLDaddr['vcard:street-address'] = oneJSON['rows']['row']['Calle'];
  oneJSONLDaddr['vcard:postal-code'] = oneJSON['rows']['row']['CdigoPostal'];
  oneJSONLDaddr["vcard:locality"] = oneJSON['rows']['row']['Poblacin'];
  oneJSONLDaddr["vcard:country-name"] = 'EspaÃ±a';
  oneJSONLD["vcard:hasAddress"] =  oneJSONLDaddr;
  var oneJSONLDgeo={};
  oneJSONLDgeo['vcard:latitude'] = oneJSON['rows']['row']['Latitud'];
  oneJSONLDgeo['vcard:longitude'] = oneJSON['rows']['row']['Longitud'];
  oneJSONLD["vcard:hasGeo"] = oneJSONLDgeo;
  oneJSONLD['vcard:tel'] = oneJSON['rows']['row']['Telfono'];
  oneJSONLD['vcard:url'] = oneJSON['rows']['row']['Web'];
  var cp = oneJSON['rows']['row']['CdigoPostal'];
  oneJSONLDvcard['dbpediaont:relatedPlaces'] = 'http://rdf.onekin.org/ode/hospitales/'+cp;
  oneJSONLDvcard['dbpediaont:relatedPlaces'] = 'http://rdf.onekin.org/ode/farmacias/'+cp;
  response.object = oneJSONLD;]]>
	</execute>
</function>
    </bindings> 
 </table>
