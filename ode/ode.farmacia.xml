<?xml version="1.0" encoding="UTF-8"?>
      <table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
    <meta>
        <author>Iker Azpeitia (www.onekin.org)</author>
        <description>LD de una farmacia</description>
        <documentationURL>http://opendata.euskadi.eus/</documentationURL>
        <!--lowering-->
        <sampleQuery> URIPattern: http://rdf.onekin.org/ode.farmacia/{documentname}</sampleQuery>
        <sampleQuery> URIExample: http://rdf.onekin.org/ode.farmacia/ECHEVERRIA BARRENECHEA, Amaia</sampleQuery>
        <sampleQuery> use 'store://MCu23iYfNpwLI6N5N5PTFp' as t; select * from t where documentname = 'ECHEVERRIA BARRENECHEA, Amaia' | t.lifting('http://rdf.onekin.org/ode/farmacia/ECHEVERRIA BARRENECHEA, Amaia')</sampleQuery>
    </meta>
    <bindings>
        <select itemPath="results.*" produces="XML">
            <inputs>
		<key id="url" type="xs:string" paramType="variable" default="http://opendata.euskadi.eus/contenidos/ds_localizaciones/farmacias_de_euskadi/opendata/farmacias.xml"/>
		<key id="documentname" type="xs:string" paramType="variable" required="true"/>
             </inputs>
             <execute>
                <![CDATA[
 var q = "env 'store://datatables.org/alltableswithkeys'; select row from xml where url =@url AND row.documentname =@documentname";
 var params ={};
 params ['url']= url;
params ['documentname']= documentname;

 var query = y.query (q,params); 
 response.object =  query.results;
 ]]>
            </execute>
      </select>
  <function name="lifting">
	<inputs>
		<pipe id="oneXML" paramType="variable"/>
		<key id="URI" paramType="variable" required="true"/>
	</inputs>
	<execute>
	<![CDATA[
	var oneJSON= y.xmlToJson(oneXML);
	var oneJSONLD={};
	oneJSONLD['@id']=URI;
	oneJSONLD['@context']= {"vcard":"http://www.w3.org/2006/vcard/ns#","dcterms":"http://purl.org/dc/terms/","schema":"http://schema.org/"};
	oneJSONLD['@type']= 'schema:Pharmacy';

  oneJSONLD['dcterms:title'] = oneJSON['rows']['row']['documentname'];
  oneJSONLD['schema:location'] = 'http://rdf.onekin.org/ode/municipio/' + oneJSON['rows']['row']['sanidadtown'];
  oneJSONLDvcard={};
  oneJSONLDvcard['@type'] = 'vcard:Address';
  oneJSONLDvcard['vcard:vcard:street-address'] = oneJSON['rows']['row']['sanidadstreet'];
  oneJSONLDvcard['vcard:postal-code'] = oneJSON['rows']['row']['sanidadpostalcode'];
  oneJSONLDvcard['vcard:region'] = oneJSON['rows']['row']['sanidadregion'];
  oneJSONLDvcard['vcard:locality'] = oneJSON['rows']['row']['sanidadtown']
  oneJSONLDvcard['vcard:url'] = oneJSON['rows']['row']['physicalurl'];
oneJSONLD['vcard:hasAddress']=oneJSONLDvcard;
	response.object = oneJSONLD;]]>
	</execute>
</function>
    </bindings> 
 </table>
