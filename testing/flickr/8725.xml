<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
    <author>Iker Apeitia</author>
    <documentationURL>https://www.flickr.com/services/api/flickr.photos.getInfo.html</documentationURL>
    <sampleQuery> URIPattern: http://rdf.onekin.org/flickr/photograph/{dcterms:identifier}</sampleQuery>
    <sampleQuery> URIExample: http://rdf.onekin.org/flickr/photograph/27376196615</sampleQuery>
	</meta>
  <bindings>
   <select itemPath="rsp.photo" produces="XML">
      <urls>
        <url env="all">https://api.flickr.com/services/rest/?method=flickr.photos.getInfo</url>
      </urls>
      <inputs>
        <key id="photo_id" as="dcterms:identifier" type="xs:string" paramType="query" />
        <key id="api_key" type="xs:string" private="true" paramType="query" default="4fb031bf5b2f138576d011ff37f31565"/>
      </inputs>
    </select>
 <function name="lifting">
  <inputs>
     <pipe id="oneXML" paramType="variable"/>
     <key id="URI" paramType="variable" required="true"/>
  </inputs>
 <execute><![CDATA[
 var oneJSON= y.xmlToJson(oneXML);
 var oneJSONLD = {};

var variables = {}; 
variables['latitude']=getValue("oneJSON['photo']['location']['latitude']");
variables['longitude']=getValue("oneJSON['photo']['location']['longitude']");

 oneJSONLD['@id'] = URI;
 oneJSONLD['@context'] = {"geo":"http://www.w3.org/2003/01/geo/wgs84_pos#","schema":"http://schema.org/","schema:locationCreated":{"@type":"@id"}};
 oneJSONLD['@type'] = 'schema:Photograph';
 oneJSONLD['schema:name'] = oneJSON['photo']['title'];
 oneJSONLD['schema:description'] = oneJSON['photo']['description'];
 oneJSONLD['schema:thumbnailUrl'] = 'https://c1.staticflickr.com/'+oneJSON['photo']['farm']+'/'+oneJSON['photo']['server'] +'/'+oneJSON['photo']['id']+'_'+oneJSON['photo']['secret']+'_z.jpg';
 oneJSONLD['schema:uploadDate'] = oneJSON['photo']['dates']['taken'];
 oneJSONLD['schema:contentUrl'] = oneJSON['photo']['urls']['url'].content;
 oneJSONLD['schema:interactionCount'] = oneJSON['photo']['views'];
 oneJSONLD['geo:lat']=getValue("oneJSON['photo']['location']['latitude']");
 oneJSONLD['geo:long']=getValue("oneJSON['photo']['location']['longitude']");
 oneJSONLD['schema:locationCreated']= getInterlinkVars('http://rdf.onekin.org/geonames/feature/{latitude}/{longitude}', variables);
    oneJSONLD['schema:about']=[];
 for (var LOOP = 0; LOOP < oneJSON['photo']['tags']['tag'].length; LOOP++){
    oneJSONLD['schema:about'].push ('http://dbpedia.org/resource/'+oneJSON['photo']['tags']['tag'][LOOP]['raw']);
 }
 response.object = oneJSONLD;

function getInterlinkVars (urlpattern, jsonVars){
 for(var i in jsonVars){
  try{urlpattern=urlpattern.replace('{'+i+'}', jsonVars[i]);}catch(err){}
 }
return urlpattern;
}

function getInterlink (urlpattern, value){
	try{return value? urlpattern.replace(/{.*}/, value) : null;}catch(err){return null;}}

function getRegexpValue(regexp, value){
 	try{return value.match(regexp)[0];}catch(err){return null;}}

function getValue(dataPath) {
	try{return eval(dataPath) || null; }catch(err){return null;}}

]]>
   </execute>
  </function>
 </bindings>
</table>