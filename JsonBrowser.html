<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:widget="http://www.netvibes.com/ns/">
    <head>

        <!-- Application Metas -->
        <title>JSON-LD Browser - www.onekin.org</title>
        <meta name="author" content="JOnekin.org (Iker Azpeitia)" />
        <meta name="description" content="A JSON-LD Browser by www.onekin.org" />

        <!-- Application Standalone emulation files -->
        <link rel="stylesheet" type="text/css"
            href="http://uwa.netvibes.com/lib/c/UWA/assets/css/standalone.css" />
        <script type="text/javascript"
            src="http://uwa.netvibes.com/lib/c/UWA/js/UWA_Standalone_Alone.js"></script>

        <!-- Application Preferences -->
        <widget:preferences>
            			<widget:preference name="uri" type="text" label="Deref URI" defaultValue="http://rdf.onekin.org/weather.forecast.ldw/2502265"/>
            			<widget:preference name="defaulturi" type="text" label="Reset URI" defaultValue="http://rdf.onekin.org/weather.forecast.ldw/2502265"/>
        </widget:preferences>

        <!-- Application JavaScript Source -->
        <script type="text/javascript">
        //<![CDATA[

            /*
                We create the global MyWidget object (it could be any other name).
                This object will be used to store variables and functions.
            */
            var MyWidget = {

                onLoad: function() {
					uri = widget.getValue('uri');
                    MyWidget.urlCall(uri);
                },
				urlCall: function(url) {
                    widget.setValue('uri', url);
						UWA.Data.request(url, {
						         onComplete: MyWidget.onComplete,
						        onFailure: MyWidget.onFailure,
						       method: 'GET',
				        data: {      }
								                    });
				},
				hashIt: function  (s) {
									var hash = 0, strlen = s.length, i, c;
									if (strlen === 0 ) {
									return hash;
									}
									for (i = 0; i < strlen; i++ ) {
									c = s.charCodeAt( i );
									hash += c;
									}
									return hash;
									},
			linkify: function(text){
            	if (text) {
						var exp = /,/g;
						text = text.replace(exp,",<br/>");
						text = text.replace(/http[^"]*/g,
							function(url){
								var find = '\\\\';
									var re = new RegExp(find, 'g');
								url = url.replace(re, '');
				             		return '<a style="background-color:blue;color:white" id ="'+MyWidget.hashIt(url)+'" href="' + url + '" onclick="return check(event)">' + url + '</a>';}
												);
										}
                url = widget.getValue('uri');
                urltext =  'Dereferenced URI: <a style="background-color:red;color:black" id ="'+MyWidget.hashIt(url)+'" href="' + url + '" onclick="return check(event)">' + url + '</a>' ;
                
            text = urltext + '<br/><br/>INDIVIDUAL: <br/>'+text;        
					return text;
								},
                onComplete: function(json) {
				    txt=MyWidget.linkify(json);
                    MyWidget.body ('info', txt);
                },
                onFailure: function(error) {
                    widget.setValue('uri', widget.getValue('defaulturi'));
                     MyWidget.body ('error', 'Problem retrieving data. Error:  ' + error);
                },
                body: function (cls,txt){
                    widget.setBody(txt);
                }
            }

            function check(event){
                     MyWidget.body ('error', 'Loading.... ');
						  var uri = event.target.href;
								MyWidget.urlCall(uri);
								return false;
						}

            widget.addEvent('onLoad', MyWidget.onLoad);

        //]]>
        </script>
    </head>
		<body>

......
		</body>

</html>
