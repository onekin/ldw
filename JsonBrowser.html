<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:widget="http://www.netvibes.com/ns/">
    <head>

        <!-- Application Metas -->
        <title>JSON-LD Browser - www.onekin.org</title>
        <meta name="author" content="www.onekin.org (Iker Azpeitia)" />
        <meta name="description" content="A JSON-LD Browser by www.onekin.org" />

        <!-- Application Standalone emulation files -->
        <link rel="stylesheet" type="text/css"
            href="http://uwa.netvibes.com/lib/c/UWA/assets/css/standalone.css" />
        <script type="text/javascript"
            src="http://uwa.netvibes.com/lib/c/UWA/js/UWA_Standalone_Alone.js"></script>

        <!-- Application Preferences -->
        <widget:preferences>
            			<widget:preference name="url" type="text" label="JSON-LD url" defaultValue="http://rdf.onekin.org/weather.forecast.ldw/2502265"/>
        </widget:preferences>

        <!-- Application JavaScript Source -->
        <script type="text/javascript">
        //<![CDATA[

            /*
                We create the global MyWidget object (it could be any other name).
                This object will be used to store variables and functions.
            */
            var MyWidget = {

							anchoruri: null,
							anchorjsontxt: null,

                onLoad: function() {
									MyWidget.anchoruri = document.getElementById("uri");
									uri = widget.getValue('url');
									MyWidget.anchoruri.value = uri;
									MyWidget.anchorjsontxt = document.getElementById("jsontxt");
                  MyWidget.urlCall(uri);
                },
								urlCall: function(url) {
								                    UWA.Data.request(url, {
								                        onComplete: MyWidget.onComplete,
								                        onFailure: MyWidget.onFailure,
								                        method: 'GET',
								                        data: {
								                        }
								                    });
								                },
									hashIt: function  (s) {
									var hash = 0, strlen = s.length, i, c;
									if (strlen === 0 ) {
									return hash;
									}
									for (i = 0; i < strlen; i++ ) {
									c = s.charCodeAt( i );
									hash += c;
									}
									return hash;
									},
									check: function (event){
											MyWidget.anchoruri.value = event.target.href;
											createIndividual();
											return false;
									},
								linkify: function(text){
										if (text) {
											var exp = /,/g;
											text = text.replace(exp,",\n");
												text = text.replace(/http[^"]*/g,
														function(url){
																var find = '\\\\';
																					var re = new RegExp(find, 'g');
																					url = url.replace(re, '');
																return '<a id ="'+MyWidget.hashIt(url)+'" href="' + url + '" onclick="return check(event)">' + url + '</a>';
														}
												);
										}
										return text;
								},
                onComplete: function(json) {
										MyWidget.anchorjsontxt.innerHTML=MyWidget.linkify(json);
                },
                onFailure: function(error) {
											MyWidget.anchorjsontxt.innerHTML="Problem retrieving data. Error: "+error;
                }
            }

						function check(event){
							MyWidget.anchorjsontxt.innerHTML='Loading...';
						  var uri = event.target.href;
								MyWidget.anchoruri.value = uri;
								MyWidget.urlCall(uri);
								return false;
						}

												function buttoned(){
													MyWidget.anchorjsontxt.innerHTML='Loading...';
												  var uri = MyWidget.anchoruri.value;
														MyWidget.anchoruri.value = uri;
														MyWidget.urlCall(uri);
														return false;
												}

            widget.addEvent('onLoad', MyWidget.onLoad);

        //]]>
        </script>
    </head>
		<body>

		<p>LDBrowser: a Linked Data Browser.</p>

		Write a URI and push Derefecenciaate button or navigate clicking on links.
		<br/>
		    <input type="button" onclick="buttoned()" value="Derefereenciate"> <input type="text" name="uri" id="uri" value="set url " size="80"><br>
		  
		</form>

		    <pre id="jsontxt">
		JSON-LD response will appear here.
		    </pre>

		</body>

</html>
