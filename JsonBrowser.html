<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:widget="http://www.netvibes.com/ns/">
<head>
<meta name="author" content="Onekin.org (Iker Azpeitia)"/>
<meta name="description" content="Json Browser"/>
<meta name="apiVersion" content="1.0"/>
<meta name="inline" content="false"/>
<meta name="autoRefresh" content="-1"/>
<meta name="debugMode" content="false"/>
<!-- Application Standalone emulation files -->
<link rel="stylesheet" type="text/css"
		href="http://uwa.netvibes.com/lib/c/UWA/assets/css/standalone.css" />
<script type="text/javascript"
		src="http://uwa.netvibes.com/lib/c/UWA/js/UWA_Standalone_Alone.js"></script>
		<title>JSON-LD Browser</title>
<link rel="icon" type="image/png" href="http://158.227.178.168:8080/resources/images/logo.jpg"/>
<widget:preferences>
<preference name="apiurl" type="text" label="HelpSpot URL (must end with /)" defaultValue="http://rdf.onekin.org/weather.forecast.ldw/2502265"/>
</widget:preferences>
<script type="text/javascript">
	var w = {}
	w.anchoruri = null;
	w.anchorjsontxt = null;

	widget.onLoad = function() {
		//If we know a username/password then continue or else let the user know
				//Get data, data is parsed and inserted via HelpSpot_Show_Filter function
				w.anchoruri = document.getElementById("uri");
		 	  w.anchorjsontxt = document.getElementById("jsontxt");

			UWA.Data.getJson(
				widget.getValue('apiurl'),
				w.showIt
			);
		}

	w.showIt= function(json){
		//Check that API enabled
		createIndividual()
	}

	function createIndividual() {
		w.anchorjsontxt.innerHTML='Loading...';
	  var uri = w.anchoruri.value;
	  callURLJSON(uri, function (resp) {individualLoaded(resp);});
	}

	function individualLoaded(resp){
	    h=resp;
	//  var h= JSON.stringify(resp);
	    //h= decodeURIComponent(resp);
	  w.anchorjsontxt.innerHTML=linkify(h);
	}

	function linkify(text){
	    if (text) {
	    	var exp = /,/g;
	    	text = text.replace(exp,",\n");
	        text = text.replace(/http[^"]*/g,
	            function(url){//url = decodeURIComponent(url);
	                          //alert(url);
	                          //url = unescape(url);
	                          //alert(url);

	                var find = '\\\\';
	                          var re = new RegExp(find, 'g');
	                          url = url.replace(re, '');
	                return '<a id ="'+hashIt(url)+'" href="' + url + '" onclick="return check(event)">' + url + '</a>';
	            }
	        );
	    }
	    return text;
	}

	    function check(event){
	        w.anchoruri.value = event.target.href;
	        createIndividual();
	        return false;
	    }

	function hashIt (s) {
	var hash = 0, strlen = s.length, i, c;
	if (strlen === 0 ) {
	return hash;
	}
	for (i = 0; i < strlen; i++ ) {
	c = s.charCodeAt( i );
	hash += c;
	}
	return hash;
	}

	function callURLJSON(url, callback){
	  //console.log ('URLjson calling: '+url);
	  var xmlhttp = createCrossDomainRequest();
	  xmlhttp.open('GET', url, true);
	  xmlhttp.setRequestHeader('Accept','application/json; q=0.9, application/rdf+xml; q=0.5');
		xmlhttp.onreadystatechange = function() {
	    if (xmlhttp.readyState == 4) {
	        if(xmlhttp.status == 200) {
	          //console.log('xmlhttp.status::  '+xmlhttp.status);
	          // console.info(xmlhttp.responseText);
	            var obj = xmlhttp.responseText;
	            callback (obj);
	         }else{
	    		w.anchorjsontxt.innerHTML="Problem retrieving data. Status: "+xmlhttp.status + ' | '+xmlhttp.statusText +' \n Response: ' + xmlhttp.responseText;
	  		}
	    }
	};
	xmlhttp.send(null);
	}


	function createCrossDomainRequest(){
	var request;
	if (window.XDomainRequest){   //IE8
	  request = new window.XDomainRequest();
	} else if (window.XMLHttpRequest)
	  {// code for all new browsers
	      request=new XMLHttpRequest();
	  }
	else if (window.ActiveXObject)
	  {// code for IE5 and IE6
	      request=new ActiveXObject("Microsoft.XMLHTTP");
	  }
	if (request!=null)
	  {
	      return request;
	  }
	else
	  {
	      alert("Your browser does not support XMLHTTP.");
	  }
	}

	</script>

</head>
<body>

<p>LDBrowser: a Linked Data Browser. LDB</p>

Write a URI and push Get button. Navigate clicking on links.
<br/>
    URI: <input type="text" name="uri" id="uri" value="http://rdf.onekin.org/weather.forecast.ldw/2502265" size="80"><br>
  <input type="button" onclick="createIndividual()" value="Get">
</form>

    <pre id="jsontxt">
JSON-LD response will appear here.
    </pre>

</body>
</html>
